cali.map <- map("state", regions = "california",fill=FALSE, lty=1, lwd=2) + geom_point(data=ration.latlong,aes(x=long,y=lat),colour='Deep Pink')
cali.map + geom_point(data=ration.latlong,aes(x=long,y=lat),colour='Deep Pink')
libray(ggplot2)
library(ggplot2)
cali.map + geom_point(data=ration.latlong,aes(x=long,y=lat),colour='Deep Pink')
cali.map <- map("state", regions = "california",fill=FALSE, lty=1, lwd=2) + geom_point(data=ration.latlong,aes(x=long,y=lat),colour='Deep Pink')
head(ration.latlong)
names(ration.latlong)
cali.map <- map("state", regions = "california",fill=FALSE, lty=1, lwd=2) + geom_point(data=ration.latlong,aes(x=lat,y=long),colour='Deep Pink')
p <- ggplot() + coord_fixed() + xlab("") + ylab("")
base_world_messy <- p + geom_polygon(data=calimap, aes(x=long, y=lat, group=group), colour="light green", fill="light green")
base_world_messy <- p + geom_polygon(data=cali.map, aes(x=long, y=lat, group=group), colour="light green", fill="light green")
california <- map_data("california")
california <- map_data("California")
california <- map_data("usa",region='California')
california <- map_data("usa")
map_data(data="state", regions = "california")
map("state", regions = "california")
points(ration.latlong$lat,ration.latlong$long,pch=19,col='deepskyblue',cex=0.4)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=0.4)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=0.4)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=0.4)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=2)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=1)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=1)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=0.5)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex=0.8)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =0.9)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =0.9)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =13)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =10)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =9)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =5)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =3)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =3)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =2)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =2)
hist(ration.latlong)
hist(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015)
hist(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,nbins=100)
??hist
hist(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,breaks=100)
hist(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,breaks=400)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =0.521)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex =0.8)
head(ration.lat.)
head(ration.lat.long)
head(ration.latlong)
max(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015)
ration.latlong$newval <- ((ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015)/max(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,breaks=400))*2
max(ration.latlong$newval)
ration.latlong$newval <- round(((ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015)/max(ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,breaks=400))*2,digits=0)
hist(ration.latlong$newval )
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = 0.5)
names(ration.latlong)
head(latlong)
write.csv(latlong,'latlongclean.csv')
setwd('/Users/Diego/Desktop/Projects_Code/cleanweb_hackathon/waterSharing/data/')
write.csv(latlong,'csv/latlongclean.csv')
head(ration.laglong)
head(ration.larlong)
head(ration.latlong)
unique(ration.latlong$REPORTED.Units)
ration.latlong$liters <- ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Units*(1/0.264172),0)
names(ration.latlong)
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),0)
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172)),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172)),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))))
hist(ration.latlong$liters.2014.2015)
ration.latlong$newval <- round(((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015,breaks=400))*5,digits=0)
hist(ration.latlong$newva)
hist(ration.latlong$newval)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
ration.latlong$newval <- round(((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015,breaks=400))*10,digits=0)
hist(ration.latlong$newval)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
head(ration.latlong$newval)
ration.latlong$newval
ration.latlong$newval <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*10
ration.latlong$newval
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
ration.latlong$newval <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*5
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
data(landings)
data(coast)
xlim <- c(-12,-5)
ylim <- c(50,56)
agg <- aggregate(list(z=landings$LiveWeight),list(x=landings$Lon,y=landings$Lat),sum)
basemap(xlim, ylim, main = "Gadoid landings")
draw.shape(coast, col="cornsilk")
draw.bubble(agg$x, agg$y, agg$z, maxradius=0.5, pch=21, bg="#00FF0050")
legend.bubble("topright", z=round(max(agg$z)/1000,0), maxradius=0.5, inset=0.02, bg="lightblue",
txt.cex=0.8, pch=21, pt.bg="#00FF0050")
ration.latlong$newval <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*2
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$newval)
names(ration.latlong)
ration.latlong$liters.2014.2015.capita <- ratio.latlong$liters.2014.2015/ratio.latlong$Total.Population.Served
ration.latlong$capita.normalized <- ((ration.latlong$liters.2014.2015.capita)/max(ration.latlong$liters.2014.2015.capita))*2
ration.latlong$liters.2014.2015.capita <- ration.latlong$liters.2014.2015/ration.latlong$Total.Population.Served
ration.latlong$capita.normalized <- ((ration.latlong$liters.2014.2015.capita)/max(ration.latlong$liters.2014.2015.capita))*2
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$capita.normalized)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$liters.normalized)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$liters.normalized)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$liters.normalized)
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))))
ration.latlong$liters.normalized <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*2
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$liters.normalized)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$capita.normalized)
apple <- ration.latlong[order(ration.latlong$capita.normalized),]
head(apple)
apple <- ration.latlong[order(-ration.latlong$capita.normalized),]
head(apple)
hist(ration.latlong$Total.Population.Served)
small <- subset(ration.latlong, ration.latlong$Total.Population.Served<100000)
hist(small$Total.Population.Served)
hist(ration.latlong$liters.2014.2015.capita)
hist(ration.latlong$long)
banana <- subset(ration.latlong,ration.latlong$long > -100)
banana
banana <- unique.Supplier.Name((subset(ration.latlong,ration.latlong$long > -100)))
banana <- (subset(ration.latlong,ration.latlong$long > -100))
unique(banana$Supplier.Name)
San Jose  City of   Winton Water & Sanitary District
town.lat.long <- read.csv('LAT_LONG_townnames.csv')
town.lat.long <- read.csv('csv/LAT_LONG_townnames.csv')
for(i in 1:length(town.lat.long$town))
{
x <- town.lat.long$town[i]
town.lat.long$townv2[i] <- gsub('"', '', regmatches(x, gregexpr('"([^"]*)"',x))[[1]])
}
latlong <- town.lat.long %>% mutate(Supplier.Name=townv2) %>% select(Supplier.Name,lat,long)
write.csv(latlong,'csv/latlongclean.csv')
ration.latlong <- join(rationing.data,latlong,by=c('Supplier.Name'),type='left',match='all')
banana <- (subset(ration.latlong,ration.latlong$long > -100))
unique(banana$Supplier.Name)
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))))
ration.latlong$liters.normalized <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*2
#2014 and 2015 per Capita
ration.latlong$liters.2014.2015.capita <- ration.latlong$liters.2014.2015/ration.latlong$Total.Population.Served
ration.latlong$capita.normalized <- ((ration.latlong$liters.2014.2015.capita)/max(ration.latlong$liters.2014.2015.capita))*2
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$capita.normalized)
town.lat.long <- read.csv('csv/LAT_LONG_townnames.csv')
for(i in 1:length(town.lat.long$town))
{
x <- town.lat.long$town[i]
town.lat.long$townv2[i] <- gsub('"', '', regmatches(x, gregexpr('"([^"]*)"',x))[[1]])
}
latlong <- town.lat.long %>% mutate(Supplier.Name=townv2) %>% select(Supplier.Name,lat,long)
write.csv(latlong,'csv/latlongclean.csv')
ration.latlong <- join(rationing.data,latlong,by=c('Supplier.Name'),type='left',match='all')
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))))
ration.latlong$liters.normalized <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*2
#2014 and 2015 per Capita
ration.latlong$liters.2014.2015.capita <- ration.latlong$liters.2014.2015/ration.latlong$Total.Population.Served
ration.latlong$capita.normalized <- ((ration.latlong$liters.2014.2015.capita)/max(ration.latlong$liters.2014.2015.capita))*2
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$capita.normalized)
apple <- ration.latlong[order(-ration.latlong$liters.2014.2015),]
head(apple)
quick <- subset(raion.latlong, ration.latlong$Supplier.Name=='San Francisco Public Utilities Commission')
quick <- subset(ration.latlong, ration.latlong$Supplier.Name=='San Francisco Public Utilities Commission')
map("state", regions = "california")
points(quick$long,quick$lat,pch=19,col='deepskyblue',cex = 2)
head(ration.latlong)
class(ration.latlong$Reporting.Month)
banana <- as.string(ration.latlong$Reporting.Month)
banana <- substring(ration.latlong$Reporting.Month, 1, 1)
head(banana)
banana <- substring(ration.latlong$Reporting.Month, 1, 3)
banana
ration.latlong$Month <- substring(ration.latlong$Reporting.Month, 1, 3)
head(ration.latlong)
banana <- substring(ration.latlong$Reporting.Month, 1, -3)
head(banana)
banana <- substring(ration.latlong$Reporting.Month, 1, -2)
banana
head(banana)
head(banana)
banana <- substring(ration.latlong$Reporting.Month, 1,1)
head(banana)
banana <- substring(ration.latlong$Reporting.Month, 2,1)
head(banana)
banana <- substring(ration.latlong$Reporting.Month, 1,4)
head(banana)
substr(x, nchar(x)-n+1, nchar(x))
x <- "some text in a string"
substr(x, nchar(x)-3+1, nchar(x))
bbs <- substr(ration.latlong$Reporting.Month, nchar(ration.latlong$Reporting.Month)-3+1, nchar(ration.latlong$Reporting.Month))
x <- as.character(ration.latlong$Reporting.Month)
bbs <- substr(x, nchar(x)-3+1, nchar(x))
head(bbs)
bbs <- substr(x, nchar(x)-2+1, nchar(x))
head(bbs)
x <- as.character(ration.latlong$Reporting.Month)
ration.latlong$Year <- substr(x, nchar(x)-2+1, nchar(x))
head(ration.latlong)
head(ration.latlong,20)
names(ration.latlong)
head(ration.latlong$Conservation.Standard..starting.in.June.2015.)
unique(ration.latlong$Conservation.Standard..starting.in.June.2015.)
wellid <- read.csv('csv/wellids.csv')
head(wellid)
class(wellid$wellid)
wellid$digits <- (wellid$wellid,digits=20)
wellid$digits <- print(wellid$wellid,digits=20)
head(wellid)
wellid <- as.character(read.csv('csv/wellids.csv'))
head(wellid)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = ration.latlong$capita.normalized)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = 1)
map("state", regions = "california")
points(ration.latlong$long,ration.latlong$lat,pch=19,col='deepskyblue',cex = 0.5)
setwd('/Users/Diego/Desktop/Projects_Code/cleanweb_hackathon/waterSharing/data/')
vars1 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','Total.Monthly.Potable.Water.Production.2014','Total.Monthly.Potable.Water.Production.2013','Units','Total.Population.Served')
vars2 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','REPORTED.Total.Monthly.Potable.Water.Production.2014.2015','REPORTED.Total.Monthly.Potable.Water.Production.2013','REPORTED.Units','Total.Population.Served')
vars3 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','REPORTED.Total.Monthly.Potable.Water.Production.2014.2015','REPORTED.Total.Monthly.Potable.Water.Production.2013','REPORTED.Units','Total.Population.Served','Optional...Implementation','Conservation.Standard..starting.in.June.2015.')
# Reading data and mutating some variables
file.a <- as.data.frame(read.csv('csv/uw_supplier_data120214.csv'))[vars]
file.b <- as.data.frame(read.csv('csv/uw_supplier_data110414.csv'))[vars]
file.c <- as.data.frame(read.csv('csv/uw_supplier_data100714.csv'))[vars]
file.d <- as.data.frame(read.csv('csv/june2014june2015.csv'))[vars2] %>% mutate(Total.Monthly.Potable.Water.Production.2014=REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,Total.Monthly.Potable.Water.Production.2013=REPORTED.Total.Monthly.Potable.Water.Production.2013,Units=REPORTED.Units) %>% select(Supplier.Name,Stage.Invoked,Reporting.Month,Total.Monthly.Potable.Water.Production.2014,Total.Monthly.Potable.Water.Production.2013,Units,Total.Population.Served)
rationing.data <- as.data.frame(read.csv('june2014_august2015.csv'))[vars3] #This is variable that includes all data
setwd('/Users/Diego/Desktop/Projects_Code/cleanweb_hackathon/waterSharing/data/')
vars1 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','Total.Monthly.Potable.Water.Production.2014','Total.Monthly.Potable.Water.Production.2013','Units','Total.Population.Served')
vars2 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','REPORTED.Total.Monthly.Potable.Water.Production.2014.2015','REPORTED.Total.Monthly.Potable.Water.Production.2013','REPORTED.Units','Total.Population.Served')
vars3 <- c('Supplier.Name','Stage.Invoked','Reporting.Month','REPORTED.Total.Monthly.Potable.Water.Production.2014.2015','REPORTED.Total.Monthly.Potable.Water.Production.2013','REPORTED.Units','Total.Population.Served','Optional...Implementation','Conservation.Standard..starting.in.June.2015.')
file.a <- as.data.frame(read.csv('csv/uw_supplier_data120214.csv'))[vars]
file.d <- as.data.frame(read.csv('csv/june2014june2015.csv'))[vars2] %>% mutate(Total.Monthly.Potable.Water.Production.2014=REPORTED.Total.Monthly.Potable.Water.Production.2014.2015,Total.Monthly.Potable.Water.Production.2013=REPORTED.Total.Monthly.Potable.Water.Production.2013,Units=REPORTED.Units) %>% select(Supplier.Name,Stage.Invoked,Reporting.Month,Total.Monthly.Potable.Water.Production.2014,Total.Monthly.Potable.Water.Production.2013,Units,Total.Population.Served)
rationing.data <- as.data.frame(read.csv('june2014_august2015.csv'))[vars3] #This is variable that includes all data
rationing.data <- as.data.frame(read.csv('csv/june2014_august2015.csv'))[vars3] #This is variable that includes all data
length(unique(file.a$Supplier.Name))
length(unique(file.d$Supplier.Name))
town.names <- unique(rationing.data$Supplier.Name)
write.csv(town.names,'town_names.csv')
### After running code in Python bring back in here and merge again
town.lat.long <- read.csv('LAT_LONG_townnames.csv')
#Quick regular expression to clean the town names
for(i in 1:length(town.lat.long$town))
{
x <- town.lat.long$town[i]
town.lat.long$townv2[i] <- gsub('"', '', regmatches(x, gregexpr('"([^"]*)"',x))[[1]])
}
latlong <- town.lat.long %>% mutate(Supplier.Name=townv2) %>% select(Supplier.Name,lat,long)
write.csv(latlong,'latlongclean.csv')
#Merging
ration.latlong <- join(rationing.data,latlong,by=c('Supplier.Name'),type='left',match='all')
ration.latlong$liters.2014.2015 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2014.2015*(748/0.264172))))
ration.latlong$liters.2013 <- ifelse(ration.latlong$REPORTED.Units == 'G',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2013*(1/0.264172),ifelse(ration.latlong$REPORTED.Units == 'MG',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2013*(1000000/0.264172),ifelse(ration.latlong$REPORTED.Units == 'AF',ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2013*(325851/0.264172),ration.latlong$REPORTED.Total.Monthly.Potable.Water.Production.2013*(748/0.264172))))
ration.latlong$liters.normalized <- ((ration.latlong$liters.2014.2015)/max(ration.latlong$liters.2014.2015))*2
#2014 and 2015 per Capita
ration.latlong$liters.2014.2015.capita <- ration.latlong$liters.2014.2015/ration.latlong$Total.Population.Served
ration.latlong$capita.normalized <- ((ration.latlong$liters.2014.2015.capita)/max(ration.latlong$liters.2014.2015.capita))*2
#Adding Months and Years to the Data set
ration.latlong$Month <- substring(ration.latlong$Reporting.Month, 1, 3)
x <- as.character(ration.latlong$Reporting.Month)
ration.latlong$Year <- substr(x, nchar(x)-2+1, nchar(x))
# Time Series of Consumption per time
ration.latlong$datesIdx = paste0(ration.latlong$Month,ration.latlong$Year)
datesIdx = rev(unique(ration.latlong$datesIdx))
dfTs = array(NA,dim = c(nrow(df),length(datesIdx)),dimnames = c(df$suppliers,datesIdx))
rownames(dfTs) <- df$suppliers
colnames(dfTs) <- datesIdx
for(i in 1:nrow(df)){
for(j in 1:length(datesIdx)){
idx = which(ration.latlong$datesIdx==datesIdx[j] &
ration.latlong$Supplier.Name==suppliers[i])
if(length(idx)>0) dfTs[i,j] <- ration.latlong$liters.2014.2015[idx[1]]
}
}
# complete with year 2013
dfTs = cbind(array(0,dim = c(nrow(dfTs),12)),dfTs)
colnames(dfTs) <- c(paste0(substr(datesIdx,1,4),'3')[1:12],datesIdx)
for(i in 1:nrow(dfTs)){
for(j in 1:12){
idx = which(ration.latlong$datesIdx==datesIdx[j] & # get month one year before
ration.latlong$Supplier.Name==suppliers[i]) # get supplier
if(length(idx)>0) dfTs[i,j] <-  ration.latlong$liters.2013[idx[1]]
}
}
# plot timeseries
# iRow=5
idxZeros = which(dfTs==0,arr.ind = T)
for (i in 1:nrow(idxZeros)) dfTs[idxZeros[i,1],idxZeros[i,2]]=NA
plot(1, type="n", xaxt='n',xlab='time',ylab='consumption',log='y',
xlim=c(1,ncol(dfTs)), ylim=range(dfTs,na.rm = T)) #main=df$suppliers[iRow])
axis(1,at = 1:ncol(dfTs),labels = colnames(dfTs))
for(iRow in 1:nrow(dfTs)){
lines(1:ncol(dfTs),dfTs[iRow,],col='grey')
}
suppliers = unique(ration.latlong$Supplier.Name)
#Total Consumption August
#Total Consumption/Capita August
df = data.frame(suppliers=suppliers)
consumpAugust=rep(NA,times=nrow(df))
consumpPerCapitaAugust=rep(NA,times=nrow(df))
for(i in 1:nrow(df)){
idx=which(ration.latlong$Month=='Aug' &
ration.latlong$Year==15 &
ration.latlong$Supplier.Name==suppliers[i])
if(length(idx)>0){
consumpAugust[i] <- ration.latlong$liters.2014.2015[idx]
consumpPerCapitaAugust[i] <- ration.latlong$liters.2014.2015.capita[idx]
}
}
df$consumpAugust = consumpAugust
df$consumpPerCapitaAugust = consumpPerCapitaAugust
ration.latlong$datesIdx = paste0(ration.latlong$Month,ration.latlong$Year)
datesIdx = rev(unique(ration.latlong$datesIdx))
dfTs = array(NA,dim = c(nrow(df),length(datesIdx)),dimnames = c(df$suppliers,datesIdx))
rownames(dfTs) <- df$suppliers
colnames(dfTs) <- datesIdx
for(i in 1:nrow(df)){
for(j in 1:length(datesIdx)){
idx = which(ration.latlong$datesIdx==datesIdx[j] &
ration.latlong$Supplier.Name==suppliers[i])
if(length(idx)>0) dfTs[i,j] <- ration.latlong$liters.2014.2015[idx[1]]
}
}
# complete with year 2013
dfTs = cbind(array(0,dim = c(nrow(dfTs),12)),dfTs)
colnames(dfTs) <- c(paste0(substr(datesIdx,1,4),'3')[1:12],datesIdx)
for(i in 1:nrow(dfTs)){
for(j in 1:12){
idx = which(ration.latlong$datesIdx==datesIdx[j] & # get month one year before
ration.latlong$Supplier.Name==suppliers[i]) # get supplier
if(length(idx)>0) dfTs[i,j] <-  ration.latlong$liters.2013[idx[1]]
}
}
idxZeros = which(dfTs==0,arr.ind = T)
for (i in 1:nrow(idxZeros)) dfTs[idxZeros[i,1],idxZeros[i,2]]=NA
plot(1, type="n", xaxt='n',xlab='time',ylab='consumption',log='y',
xlim=c(1,ncol(dfTs)), ylim=range(dfTs,na.rm = T)) #main=df$suppliers[iRow])
axis(1,at = 1:ncol(dfTs),labels = colnames(dfTs))
for(iRow in 1:nrow(dfTs)){
lines(1:ncol(dfTs),dfTs[iRow,],col='grey')
}
census.data.2013 <- read.csv('data_2013.csv')
census.data.2013 <- read.csv('csv/data_2013.csv')
head(census.data.2013)
head(ration.latlong)
head(census.data.2013)
names(ration.latlong)
census.data.2013 <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name = City.Name)
head(census.data.2013)
rationing.census <- join(census.data.2013,ration.latlong,by=c('City.Name'))
rationing.census <- join(census.data.2013,ration.latlong,by=c(City.Name))
rationing.census <- join(census.data.2013,ration.latlong,by=c(Supplier.Name))
rationing.census <- join(census.data.2013,ration.latlong,by=c('Supplier.Name'))
names(rationing.census)
rationing.census <- join(census.data.2013,ration.latlong,by=c('Supplier.Name')) %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
names(rationing.census)
unique(length(Supplier.Name))
unique(length(rationing.census$Supplier.Name))
rationing.census <- join(ration.latlong,census.data.2013,by=c('Supplier.Name'),type=inner) %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
rationing.census <- join(ration.latlong,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census$Supplier.Name))
rationing.census <- join(ration.latlong,census.data.2013,by=c('Supplier.Name'),type='red') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
rationing.census <- join(ration.latlong,census.data.2013,by=c('Supplier.Name'),type='right') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census$Supplier.Name))
rationing.census <- join(ration.latlong,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census$Supplier.Name)
length(unique(rationing.census$Supplier.Name))
head(rationing.census)
write.csv(ration.latlong,'filetoclean.csv')
head(latlong)
hist(latlong$long)
hist(latlong$long,400)
hist(latlong$long,450)
val <- subset (ration.latlong,ration.latlong$long == -119.4179324)
head(val)
lenght(val$val)
length(val$val)
length(val$lat)
length(unique(val$Supplier.Name))
new.rationing.data <- read.csv('csv/new_df_diego_albert.csv')
head(new.rationing.data)
census.data.2013 <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name = City.Name)
rationing.census <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type=inner) %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
rationing.census <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
head(raioning.census)
head(rationing.census)
length(unique(rationing.census))
length(unique(rationing.census$Supplier.Name))
length(unique(new.rationing.data$Supplier.Name))
260/396
rationing.census <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
head(rationing.census)
write.csv(rationing.census.test,'rationing.census.test.csv')
rationing.census.test <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
write.csv(rationing.census.test,'rationing.census.test.csv')
write.csv(rationing.census.test,'csv/rationing.census.test.csv')
new.rationing.data <- read.csv('csv/new_df_diego_albert.csv')
census.data.2013 <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name = City.Name)
rationing.census.test <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
new.rationing.data <- read.csv('csv/new_df_diego_albert.csv')
names(new.rationing.data)
new.rationing.data <- read.csv('csv/new_df_diego_albert.csv')
census.data.2013 <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name = City.Name)
rationing.census.test <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census.test$Supplier.Name))
head(rationing.census.test)
head(new.rationing.data)
new.lat.long <- read.csv('csv/LAT_LONG_townnames_new.csv')
head(new.lat.long)
head(new.rationing.data)
rationing.census <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='left') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
head(rationing.cesus)
head(rationing.census)
rationing.census <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
head(rationing.census)
length(unique(rationing.census$Supplier.Name))
length(unique(rationing.census.test$Supplier.Name))
write.csv(rationing.census.test,'csv/rationing.census.test.csv')
new.rationing.data <- read.csv('csv/new_df_diego_albert.csv')
census.data.2013 <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name = City.Name)
rationing.census.testv2 <- join(new.rationing.data,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census.testv2$Supplier.Name))
head(rationing.census.testv2)
write.csv(rationing.census.testv2,'csv/rationing.census.testv2.csv')
forjonathan <- subset(rationing.census.testv2,rationing.census.testv2$Month == 'Aug' & rationing.census.testv2$Year == '15')
head(forjonathan)
write.csv(forjonathan,'csv/forjonathan.csv')
august.rationing <- read.csv('august_rationing_data.csv')
august.rationing <- read.csv('csv/august_rationing_data.csv')
head(august.rationing)
august.rationing <- read.csv('csv/august_rationing_data.csv') %>% select(Supplier.Name,Conservation.Standard.2015)
head(august.rationing)
ration.latlong.with.var <- merge(ration.latlong,august.rationing,by=c('Supplier.Name'))
head(ration.latlong)
head(ration.latlong.with.var)
length(unique(ration.latlong.with.var$Supplier.Name))
length(unique(ration.latlong$Supplier.Name))
ration.latlong.with.ind <- merge(ration.latlong,august.rationing,by=c('Supplier.Name'))
length(unique(ration.latlong.with.ind$Supplier.Name))
drought.indicators <- read.csv('csv/drough_indicators.csv')
head(drought.indicators)
ration.latlong.drought <- merge(ration.latlong.with.ind,drought.indicators,by=c('Supplier.Name'))
length(unique(ration.latlong.drought$Supplier.Name))
head(ration.latlong.drought)
rationing.census.drought <- join(ration.latlong.drought,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served)
length(unique(rationing.census.drought$Supplier.Name))
length(unique(ration.latlong.drought$Supplier.Name))
names(ration.latlong.drought)
ration.latlong.drought <- merge(ration.latlong.with.ind,drought.indicators,by=c('Supplier.Name')) %>% select(Supplier.Name,Total.Population.Served,liters.2014.2015,liters.2014.2015.capita,Month,Year,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
head(ration.latlong.drought)
write(ration.latlong.drought,'csv/ration.latlong.droughtalbert.csv')
write.csv(ration.latlong.drought,'csv/ration.latlong.droughtalbert.csv')
write.csv(ration.latlong.drought,'csv/rationlatlongdroughtalbert.csv')
drought.diego.albert <- read.csv('csv/diego_albert_drought.csv')
head(drought.diego.albert)
census.2013.new <- read.csv('csv/data_2013.csv')
head(census.2013.new)
rationing.census.drought <- join(ration.latlong.drought,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
head(rationing.census.drought)
census.2013.new <- read.csv('csv/data_2013.csv') %>% mutate(Supplier.Name=City.Name)
rationing.census.drought <- join(ration.latlong.drought,census.data.2013,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
head(rationing.census.drought)
rationing.census.drought <- join(ration.latlong.drought,census.2013.new,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
head(rationing.census.drought)
length(unique(rationing.census.drought$Supplier.Name))
rationing.census.drought <- join(drought.diego.albert,census.2013.new,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
length(unique(rationing.census.drought$Supplier.Name))
names(rationing.census.drought)
forjonathannew <- subset(rationing.census.drought,rationing.census.drought$Month == 'Aug' & rationing.census.drought$Year == '15')
length(unique(forjonathannew$Supplier.Name))
head(forjonathannew)
write.csv(forjonathannew,'csv/forjonathannew.csv')
names(drought.diego.albert)
head(ration.latlong.drought)
names(ration.latlong.with.ind)
ration.latlong.droughtv2 <- merge(ration.latlong.with.ind,drought.indicators,by=c('Supplier.Name')) %>% select(Supplier.Name,lat,long,Total.Population.Served,liters.2014.2015,liters.2014.2015.capita,Month,Year,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
write.csv(ration.latlong.droughtv2,'csv/rationlatlongdroughtalbertv2.csv')
write.csv(ration.latlong.droughtv2,'csv/rationalbert2.csv')
write.csv(ration.latlong.droughtv2,'csv/rationalberttwo.csv')
drought.diego.albert.two <- read.csv('csv/diego_alber_droughtvtwo.csv')
head(drought.diego.albert.two)
rationing.census.drought.two <- join(drought.diego.albert.two,census.2013.new,by=c('Supplier.Name'),type='inner') %>% select(Supplier.Name,lat,long,Total.Population,Median.Income,Gini.Index,White.Proportion..in...,Household.Size,Agriculture.Employement..in...,liters.2014.2015,liters.2014.2015.capita,Month,Year,Total.Population.Served,Conservation.Standard.2015,SPEI_3YEARS,SPI_3YEARS)
length(unique(rationing.census.drought.two$Supplier.Name))
names(rationing.census.drought.two)
forjonathannew <- subset(rationing.census.drought.two,rationing.census.drought.two$Month == 'Aug' & rationing.census.drought.two$Year == '15')
length(unique(forjonathannew$Supplier.Name))
forjonathannewtwo <- subset(rationing.census.drought.two,rationing.census.drought.two$Month == 'Aug' & rationing.census.drought.two$Year == '15')
length(unique(forjonathannewtwo$Supplier.Name))
write.csv(forjonathannewtwo,'csv/forjonathannewlats.csv')

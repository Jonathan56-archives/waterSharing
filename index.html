<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>V2G-Sim</title>
    <!-- d3 -->
    <script type="text/javascript" src="js/d3.js"></script>

    <style type="text/css">
svg {
  font: 10px sans-serif;
}

.background path {
  fill: none;
  stroke: #ddd;
  shape-rendering: crispEdges;
}

.foreground path {
  fill: none;
  stroke: steelblue;
}

.brush .extent {
  fill-opacity: .3;
  stroke: #fff;
  shape-rendering: crispEdges;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
  cursor: move;
}

/*html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}*/

#map {
  width: 1300px;
  height: 600px;
}


#floating-panel {
  position: absolute;
  top: 10px;
  left: 25%;
  z-index: 5;
  background-color: #fff;
  padding: 5px;
  border: 1px solid #999;
  text-align: center;
  font-family: 'Roboto','sans-serif';
  line-height: 30px;
  padding-left: 10px;
}

#floating-panel {
  background-color: #fff;
  border: 1px solid #999;
  left: 25%;
  padding: 5px;
  position: absolute;
  top: 10px;
  z-index: 5;
}

</style>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization">
</script>

<script>


</script>
</head>


<body>
    <!-- Page Content -->
    <div id="page-content-wrapper">
        <div class="container-fluid">      
          <div class="container" id="chartContainer1"></div>
          <div id="map"></div>
          <script type="text/javascript">

            var map, heatmap;

            function initialize() {

              map = new google.maps.Map(document.getElementById('map'), {
              zoom: 5,
              center: {lat: 37.775, lng: -122.434},
              mapTypeId: google.maps.MapTypeId.TERRAIN
            });
              var town = [];
              var fulldata;


              d3.csv("latlongclean.csv", function(data) {

              fulldata = data;
              data.forEach(function(d) {
                  d.name = d.name;
                  d.lat = parseFloat(d.lat);
                  d.long = parseFloat(d.long);
                });

                  data.forEach(function(d){
                   town.push(new google.maps.LatLng(d.lat, d.long))
                });

                heatmap = new google.maps.visualization.HeatmapLayer({
                data: town,
                map: map
              });

                heatmap.set('radius', 30)
                heatmap.set('opacity', 1)

              });

            }

            google.maps.event.addDomListener(window, 'load', initialize);









            var margin = {top: 30, right: 10, bottom: 10, left: 10},
                width = 1300 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            var x = d3.scale.ordinal().rangePoints([0, width], 1),
                y = {},
                dragging = {};

            var line = d3.svg.line(),
                axis = d3.svg.axis().orient("left"),
                background,
                foreground;

            var map;
            var heatmap, binList;
            var town = new Array();

            var svg = d3.select("#chartContainer1").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            d3.csv("data.csv", function(error, cars) {

              cars.forEach(function(d) {
                                // d.waterRationing = parseFloat(d.waterRationing);
                                // d.waterConsumption = parseFloat(d.waterConsumption);
                                // d.waterRationningPerCapita = parseFloat(d.waterRationningPerCapita);
                                // d.waterConsumptionPerCapita = parseFloat(d.waterConsumptionPerCapita);
                                // d.droughtIndex = parseFloat(d.droughtIndex);
                                // d.groundWaterLevel = parseFloat(d.groundWaterLevel);
                                // d.agroWorker = parseFloat(d.agroWorker);
                                // d.averageIncome = parseFloat(d.averageIncome);
                                // d.householdSize = parseFloat(d.householdSize);
                                // d.GINIIndex = parseFloat(d.GINIIndex);
                                // d.race = parseFloat(d.race);
                                d.visible = false
                              });
              bindata = cars;
              // Extract the list of dimensions and create a scale for each.
              x.domain(dimensions = d3.keys(cars[0]).filter(function(d) {
                return d != "name" && (y[d] = d3.scale.linear()
                    .domain(d3.extent(cars, function(p) { return +p[d]; }))
                    .range([height, 0]));
              }));

              // Add grey background lines for context.
              background = svg.append("g")
                  .attr("class", "background")
                .selectAll("path")
                  .data(cars)
                .enter().append("path")
                  .attr("d", path);

              // Add blue foreground lines for focus.
              foreground = svg.append("g")
                  .attr("class", "foreground")
                .selectAll("path")
                  .data(cars)
                .enter().append("path")
                  .attr("d", path)
                  .style('stroke-width', '1.5');

              // Add a group element for each dimension.
              var g = svg.selectAll(".dimension")
                  .data(dimensions)
                .enter().append("g")
                  .attr("class", "dimension")
                  .attr("transform", function(d) { return "translate(" + x(d) + ")"; });
                  // .call(d3.behavior.drag()
                  //   .origin(function(d) { return {x: x(d)}; })
                  //   .on("dragstart", function(d) {
                  //     dragging[d] = x(d);
                  //     background.attr("visibility", "hidden");
                  //   })
                  //   .on("drag", function(d) {
                  //     dragging[d] = Math.min(width, Math.max(0, d3.event.x));
                  //     foreground.attr("d", path);
                  //     dimensions.sort(function(a, b) { return position(a) - position(b); });
                  //     x.domain(dimensions);
                  //     g.attr("transform", function(d) { return "translate(" + position(d) + ")"; })
                  //   })
                  //   .on("dragend", function(d) {
                  //     delete dragging[d];
                  //     transition(d3.select(this)).attr("transform", "translate(" + x(d) + ")");
                  //     transition(foreground).attr("d", path);
                  //     background
                  //         .attr("d", path)
                  //       .transition()
                  //         .delay(500)
                  //         .duration(0)
                  //         .attr("visibility", null);
                  //   }));

              // Add an axis and title.
              g.append("g")
                  .attr("class", "axis")
                  .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
                .append("text")
                  .style("text-anchor", "middle")
                  .attr("y", -9)
                  .text(function(d) { return d; });

              // Add and store a brush for each axis.
              g.append("g")
                  .attr("class", "brush")
                  .each(function(d) { d3.select(this).call(y[d].brush = d3.svg.brush().y(y[d]).on("brush", brush).on("brushend", brushend)); })
                .selectAll("rect")
                  .attr("x", -8)
                  .attr("width", 16);
            });
          
            // // # Functions
            // function position(d) {
            //   var v = dragging[d];
            //   return v == null ? x(d) : v;
            // }

            // function transition(g) {
            //   return g.transition().duration(500);
            // }

            // // Returns the path for a given data point.
            // function path(d) {
            //   return line(dimensions.map(function(p) { return [position(p), y[p](d[p])]; }));
            // }
            function path(d) {
              return line(dimensions.map(function(p) { return [x(p), y[p](d[p])]; }));
            }

            // function brushstart() {
            //   d3.event.sourceEvent.stopPropagation();
            // }

            // Handles a brush event, toggling the display of foreground lines.
            function brush() {
              var actives = dimensions.filter(function(p) { return !y[p].brush.empty(); });
              var extents = actives.map(function(p) { return y[p].brush.extent(); });
              // console.log(extents)
              foreground.style("display", function(d) {
                bool = actives.every(function(p, i) {
                  return extents[i][0] <= d[p] && d[p] <= extents[i][1];
                }) ? null : "none";
                d.visible = bool;
                return bool;
              }); 
            }

            function brushend() {
              binList = [];
              bindata.forEach(function(d) {
                if (d.visible) {
                  binList.push(d.name);
                }
              });
              console.log(binList);

                fulldata.forEach(function(d){
                  bindata.every(function(d2){ if (d2.name = d.name))
                  
                   town.push(new google.maps.LatLng(d.lat, d.long))
                });

                heatmap = new google.maps.visualization.HeatmapLayer({
                data: town,
                map: map
              });

                heatmap.set('radius', 30)
                heatmap.set('opacity', 1)
            }



            // function initMap() {
            //   map = new google.maps.Map(document.getElementById('map'), {
            //     zoom: 13,
            //     center: {lat: 37.775, lng: -122.434},
            //     mapTypeId: google.maps.MapTypeId.SATELLITE
            //   });

            //   heatmap = new google.maps.visualization.HeatmapLayer({
            //     data: location,
            //     map: map
            //   });
            // }

            // function initMapData() {
            //   d3.csv("latlongclean.csv", function(data) {

            //     data.forEach(function(d) {
            //       d.name = +d.name;
            //       d.lat = +d.lat;
            //       d.long = +d.long;
            //     });

            //   // data.forEach(function(d){
            //   //    town.push(new google.maps.LatLng(d.lat, d.long))
            //   // });

            //   console.log(town)
            //   // initMap();
            //   });
            // }

          </script>
        </div>
    </div>
    <!-- /#page-content-wrapper -->


    <script src="js/jquery.js"></script>

    <script src="js/bootstrap.min.js"></script>  
</body>

</html>
